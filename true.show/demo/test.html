<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, user-scalable=yes">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <title>PPT Marker</title>
    <link rel="stylesheet" type="text/css" href="asset/css/reset.css">
    <link rel="stylesheet" type="text/css" href="asset/css/app.css">
    <link rel="stylesheet" type="text/css" href="asset/css/animate.css">
    <style id="{{STYLEID}}" type="text/css">
    body {
        overflow: hidden;
    }
    
    .global {
        position: absolute;
        left: 200px;
        top: 200px;
        width: 120px;
        height: 120px;
        background: #eef;
    }
    
    .global .rot {
        border-radius: 50%;
        position: relative;
        margin: 0 auto;
        width: 30px;
        height: 30px;
        background: #09e;
        cursor: pointer;
    }
    
    .global #div {
        position: relative;
        margin-top: 10px;
        width: 100%;
        height: 80px;
        background: transparent;
        border: 1px solid #ccc;
    }
    </style>
</head>

<body>
    <div class="global">
        <div class="rot"></div>
        <div id="div" class="center">
            <div class="inner"></div>
        </div>
    </div>
    <!-- <div id="tips" class="tips-right" style="left:100px;top: 100px;visibility:visible;">122</div>
    <input type="button" value="读取剪贴板内容" onclick="readClipboardData();" />
    <br /> <textarea rows="20" cols="60" id="txtContent"></textarea> -->
</body>
<script src="asset/js/jquery.js"></script>
<script src="asset/js/jquery-ui.js"></script>
<script type="text/javascript">
function getClipboard() {
    if (window.clipboardData) {
        return (window.clipboardData.getData('Text'));
    } else if (window.netscape) {
        netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
        var clip = Components.classes['@mozilla.org/widget/clipboard;1'].createInstance(Components.interfaces.nsIClipboard);
        if (!clip) return;
        var trans = Components.classes['@mozilla.org/widget/transferable;1'].createInstance(Components.interfaces.nsITransferable);
        if (!trans) return;
        trans.addDataFlavor('text/unicode');
        clip.getData(trans, clip.kGlobalClipboard);
        var str = new Object();
        var len = new Object();
        try {
            trans.getTransferData('text/unicode', str, len);
        } catch (error) {
            return null;
        }
        if (str) {
            if (Components.interfaces.nsISupportsWString) str = str.value.QueryInterface(Components.interfaces.nsISupportsWString);
            else if (Components.interfaces.nsISupportsString) str = str.value.QueryInterface(Components.interfaces.nsISupportsString);
            else str = null;
        }
        if (str) {
            return (str.data.substring(0, len.value / 2));
        }
    }
    return null;
}

function readClipboardData() {
    var str = getClipboard();
    console.log(str);
    var len = str.split("\n"); //获取行数
    document.getElementById("txtContent").value = str;
}


// (function($) {
//     var __defaults = {

//     };


//     function getRotated(x, y, angle) {
//         angle = -angle * Math.PI / 180;
//         var cosAngle = Math.cos(angle);
//         var sinAngle = Math.sin(angle);
//         var relativeX = (x * cosAngle) - (y * sinAngle);
//         var relativeY = (x * sinAngle) + (y * cosAngle);

//         return {
//             x: relativeX,
//             y: relativeY
//         }
//     }

//     function getRotationDegrees(obj) {
//         var matrix = obj.css("-webkit-transform") ||
//             obj.css("-moz-transform") ||
//             obj.css("-ms-transform") ||
//             obj.css("-o-transform") ||
//             obj.css("transform");
//         if (matrix !== 'none') {
//             var values = matrix.split('(')[1].split(')')[0].split(',');
//             var a = values[0];
//             var b = values[1];
//             var angle = Math.round(Math.atan2(b, a) * (180 / Math.PI));
//         } else {
//             var angle = 0;
//         }
//         return (angle < 0) ? angle += 360 : angle;
//     }

//     $.fn.draggable = function(options) {
//         return $(this).each(function() {
//             $(this).on('mousedown', function(ev) {
//                 var mouseX = ev.pageX;
//                 var mouseY = ev.pageY;
//                 var offset = $(this).offset();
//                 var offsetX = offset.left;
//                 var offsetY = offset.top;

//                 var $that = $(this);
//                 var deg = getRotationDegrees($that);
//                 var target = getRotated(offsetX, offsetY, deg);


//                 var style = $that.attr('style');
//                 if (style) {
//                   var styles = style.split(';');
//                   for (var i = 0, css; css = styles[i++];) {
//                     var kv = css.split(":");
//                     var key = $.trim(kv[0]);
//                     var value = $.trim(kv[1]);

//                     if (key == "left") {
//                       offsetX = parseFloat(value);
//                     }

//                     if (key == "top") {
//                       offsetY = parseFloat(value);
//                     }
//                   }
//                 }

//                 var targetX = mouseX - offsetX;
//                 var targetY = mouseY - offsetY;


//                 $that.attr('data-dragging', true);
//                 $(this).attr('data-px', mouseX - offsetX);
//                 $(this).attr('data-py', mouseY - offsetY);

//                 $(document).on('mousemove', function(ev) {
//                     var mouseX = ev.pageX;
//                     var mouseY = ev.pageY;
//                     var targetX = mouseX - $that.attr('data-px');
//                     var targetY = mouseY - $that.attr('data-py');

//                     var deg = getRotationDegrees($that);
//                     var target = getRotated(targetX, targetY, deg);

//                     $that.attr({
//                         "style" : "position:absolute;left: "+ targetX +"px;top: "+ targetY +"px;"
//                     });

//                     $(document).on('mouseup', function(ev) {
//                         if ($that.attr('data-dragging')) {
//                             $(document).off('mousemove');
//                             $(document).off('mouseup');
//                             $that.removeAttr('data-dragging');
//                         }
//                     });
//                 });
//             });
//         });
//     }

// })(jQuery);


window.onload = function() {
    var g = {};

    $('.rot').on('mousedown', function(event) {
        g.rotatable = true;

        g.bar = $(this);
        g.rotater = $(this).closest('.global');
        g.center = g.rotater.find(".center");
        var ox = $(g.rotater)[0].offsetLeft + $(g.center)[0].offsetLeft + $(g.center).width() / 2;
        var oy = $(g.rotater)[0].offsetTop + $(g.center)[0].offsetTop + $(g.center).height() / 2;

        g.ox = ox;
        g.oy = oy;

    });

    $(document).on('mousemove', function(event) {
        if (g.rotatable) {
            var cx = event.pageX - g.ox;
            var cy = event.pageY - g.oy;
            var to = Math.abs(cx / cy);
            var angle = Math.atan(to) / (2 * Math.PI) * 360;

            if (cx < 0 && cy < 0) {
                // 相对在左上角，第四象限，js中坐标系是从左上角开始的，这里的象限是正常坐标系 
                angle = -angle;
            } else if (cx < 0 && cy > 0) {
                // 左下角,3象限  
                angle = -(180 - angle);
            } else if (cx > 0 && cy < 0) {
                //右上角，1象限
                angle = angle;
            } else if (cx > 0 && cy > 0) {
                //右下角，2象限
                angle = 180 - angle;
            }

            rotateEl(g.rotater[0], angle);
        }
    });

    $(document).on('mouseup', function() {
        if (g.rotatable) {
            g.rotatable = false;
            g.rotater = null;
        }
    });


    function rotateEl(obj, deg) {
        obj.style.webkitTransform = 'rotate(' + deg + 'deg)';
        obj.style.mozTransform = 'rotate(' + deg + 'deg)';
        obj.style.msTransform = 'rotate(' + deg + 'deg)';
        obj.style.oTransform = 'rotate(' + deg + 'deg)';
        obj.style.transform = 'rotate(' + deg + 'deg)';
    }
};
</script>

</html>
